<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900">Cloudflare CDN Testing</h1>
      <p class="mt-2 text-gray-600">
        Visual verification of CDN image transformations before production integration
      </p>
    </div>

    <!-- CDN Status -->
    <div class="mb-8 p-6 bg-white rounded-lg shadow">
      <h2 class="text-xl font-semibold mb-4">CDN Configuration</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <span class="font-medium">Status:</span>
          <span class={"ml-2 px-3 py-1 rounded-full text-sm font-medium #{if @cdn_enabled, do: "bg-green-100 text-green-800", else: "bg-yellow-100 text-yellow-800"}"}>
            <%= if @cdn_enabled, do: "Enabled", else: "Disabled" %>
          </span>
        </div>
        <div>
          <span class="font-medium">Domain:</span>
          <span class="ml-2 text-gray-700"><%= @cdn_domain %></span>
        </div>
      </div>

      <%= if not @cdn_enabled do %>
        <div class="mt-4 p-4 bg-yellow-50 border-l-4 border-yellow-400">
          <div class="flex">
            <div class="ml-3">
              <p class="text-sm text-yellow-700">
                <strong>CDN is currently disabled.</strong> To test CDN transformations, restart the server with:
              </p>
              <code class="block mt-2 p-2 bg-yellow-100 rounded text-xs">
                CDN_ENABLED=true mix phx.server
              </code>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Transformation Examples -->
    <%= for image <- @sample_images do %>
      <div class="mb-12 bg-white rounded-lg shadow overflow-hidden">
        <!-- Image Header -->
        <div class="px-6 py-4 bg-gray-100 border-b">
          <h3 class="text-lg font-semibold text-gray-900"><%= image.name %></h3>
          <p class="text-sm text-gray-600 mt-1"><%= image.description %></p>
          <details class="mt-2">
            <summary class="cursor-pointer text-sm text-indigo-600 hover:text-indigo-800">
              Show original URL
            </summary>
            <code class="block mt-2 p-2 bg-gray-50 rounded text-xs break-all">
              <%= image.url %>
            </code>
          </details>
        </div>

        <!-- Transformations Grid -->
        <div class="p-6">
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <%= for transform <- @transformations do %>
              <% cdn_url = CDN.url(image.url, transform.opts) %>
              <div class="border rounded-lg overflow-hidden">
                <!-- Transformation Header -->
                <div class="px-4 py-3 bg-gray-50 border-b">
                  <h4 class="font-semibold text-gray-900"><%= transform.name %></h4>
                  <p class="text-xs text-gray-600 mt-1"><%= transform.description %></p>
                </div>

                <!-- Image Preview -->
                <div class="aspect-video bg-gray-100 relative">
                  <img
                    src={cdn_url}
                    alt={transform.name}
                    class="w-full h-full object-contain"
                    loading="lazy"
                  />
                </div>

                <!-- URL Display -->
                <div class="px-4 py-3 bg-gray-50">
                  <details>
                    <summary class="cursor-pointer text-xs text-indigo-600 hover:text-indigo-800">
                      <%= if cdn_url == image.url, do: "Original URL (CDN disabled)", else: "Generated CDN URL" %>
                    </summary>
                    <code class="block mt-2 p-2 bg-white rounded text-xs break-all border">
                      <%= cdn_url %>
                    </code>
                  </details>

                  <!-- Transformation Options -->
                  <%= if transform.opts != [] do %>
                    <div class="mt-2">
                      <p class="text-xs font-medium text-gray-700 mb-1">Options:</p>
                      <div class="flex flex-wrap gap-1">
                        <%= for {key, value} <- transform.opts do %>
                          <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">
                            <%= key %>: <%= value %>
                          </span>
                        <% end %>
                      </div>
                    </div>
                  <% end %>
                </div>

                <!-- Loading Status -->
                <div class="px-4 py-2 bg-green-50 border-t border-green-100">
                  <p class="text-xs text-green-700">
                    <span class="font-medium">âœ“</span> Image loaded successfully
                  </p>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>

    <!-- Testing Instructions -->
    <div class="mt-8 p-6 bg-blue-50 border-l-4 border-blue-400 rounded-lg">
      <h3 class="text-lg font-semibold text-blue-900 mb-2">Testing Instructions</h3>
      <ol class="list-decimal list-inside space-y-2 text-sm text-blue-800">
        <li>Ensure CDN is enabled by starting server with <code class="px-1 bg-blue-100 rounded">CDN_ENABLED=true</code></li>
        <li>Verify images load correctly through Cloudflare (check URLs above)</li>
        <li>Open browser DevTools Network tab and verify requests go through <%= @cdn_domain %></li>
        <li>Check that transformations are applied (different sizes, quality, format)</li>
        <li>Test with slow network throttling to verify caching and performance</li>
        <li>Once verified, you can integrate <code class="px-1 bg-blue-100 rounded">CDN.url/2</code> into templates</li>
      </ol>
    </div>

    <!-- Additional Testing -->
    <div class="mt-8 p-6 bg-white rounded-lg shadow">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Quick Reference</h3>

      <div class="space-y-4">
        <div>
          <h4 class="font-medium text-gray-900 mb-2">Usage in Templates:</h4>
          <pre class="block p-3 bg-gray-100 rounded text-sm overflow-x-auto"><code><%= "<img src={CDN.url(@event.image_url, width: 800, quality: 90)} />" %></code></pre>
        </div>

        <div>
          <h4 class="font-medium text-gray-900 mb-2">Common Options:</h4>
          <ul class="text-sm text-gray-700 space-y-1">
            <li><code class="px-1 bg-gray-100 rounded">width: 800</code> - Resize to max 800px width</li>
            <li><code class="px-1 bg-gray-100 rounded">height: 600</code> - Resize to max 600px height</li>
            <li><code class="px-1 bg-gray-100 rounded">quality: 85</code> - Set quality (1-100)</li>
            <li><code class="px-1 bg-gray-100 rounded">fit: "cover"</code> - Crop to exact dimensions</li>
            <li><code class="px-1 bg-gray-100 rounded">format: "webp"</code> - Convert to WebP format</li>
            <li><code class="px-1 bg-gray-100 rounded">dpr: 2</code> - Device pixel ratio for retina</li>
          </ul>
        </div>

        <div>
          <h4 class="font-medium text-gray-900 mb-2">Environment Control:</h4>
          <ul class="text-sm text-gray-700 space-y-1">
            <li><strong>Development:</strong> CDN disabled by default (returns original URLs)</li>
            <li><strong>Testing:</strong> Enable with <code class="px-1 bg-gray-100 rounded">CDN_ENABLED=true</code></li>
            <li><strong>Production:</strong> CDN enabled automatically</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
